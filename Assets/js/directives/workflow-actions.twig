<div>
	<rbs-button-close ng-click="closeWorkflow()"></rbs-button-close>

	<i class="icon-time icon-4x"></i>
	<h3>{{ i18n('m.rbs.admin.workflow.title', ['ucf']) }}</h3>
	<h5>
		<span ng-switch="document.publicationStatus">
			<span ng-switch-when="DRAFT">
				{{ i18n('m.rbs.admin.workflow.draft-description', ['ucf']) }}
			</span>
			<span ng-switch-when="FROZEN">
				{{ i18n('m.rbs.admin.workflow.frozen-description', ['ucf']) }}
			</span>
			<span ng-switch-when="FILED">
				{{ i18n('m.rbs.admin.workflow.filed-description', ['ucf']) }}
			</span>
			<span ng-switch-when="VALIDATION">
				{{ i18n('m.rbs.admin.workflow.validation-description', ['ucf']) }}
			</span>
			<span ng-switch-when="VALIDCONTENT">
				{{ i18n('m.rbs.admin.workflow.validcontent-description', ['ucf']) }}
			</span>
			<span ng-switch-when="UNPUBLISHABLE">
				{{ i18n('m.rbs.admin.workflow.unpublishable-description', ['ucf']) }}
			</span>
			<span ng-switch-when="PUBLISHABLE">
				{{ i18n('m.rbs.admin.workflow.publishable-description', ['ucf']) }}
			</span>
		</span>
	</h5>

	<form name="wfForm" ng-submit="submit()" ng-switch="data.action">

		<div ng-switch-when="requestValidation">
			<div class="control-group">
				<div class="controls">
					<p>
						<rbs-button-help-toggle class="pull-right" value="data.helpShown"></rbs-button-help-toggle>
						<button type="submit" class="btn"><i class="icon-bullhorn"></i> {{ i18n('m.rbs.admin.workflow.request-validation', ['ucf']) }}</button>
					</p>
				</div>
			</div>
			<rbs-advanced-mode>
				<p>{{ i18n('m.rbs.admin.workflow.run-all-steps-message') }}</p>
				<p><button type="button" class="btn btn-danger" ng-click="runWholeWorkflow()"><i class="icon-fast-forward"></i> {{ i18n('m.rbs.admin.workflow.run-all-steps-button', ['ucf']) }}</button></p>
			</rbs-advanced-mode></div>

		<div ng-switch-when="contentValidation">

			<div class="control-group">
				<div class="control-group">
					<div class="controls">
						<p>
							<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.request-validation-done', ['ucf']) }}</div>
						</p>
						<p>
							{{ i18n('m.rbs.admin.workflow.to-validate-content-you-can', ['ucf']) }}
							<rbs-kb-switch>
								<a rbs-kb-default="" href ng-href="(= document|documentURL:'form' =)">{{ i18n('m.rbs.admin.workflow.open-document-editor') }}</a>
								<a rbs-kb-when="meta" href ng-href="(= document|documentURL:'form' =)" target="_blank">{{ i18n('m.rbs.admin.workflow.open-document-editor-in-new-tab') }} <i class="icon-external-link"></i></a>
							</rbs-kb-switch>.
						</p>
						<p>
							<label class="radio">
								<input type="radio" name="contentAction" ng-model="data.contentAction" value="accept" checked/> {{ i18n('m.rbs.admin.workflow.accepted', ['ucf']) }}
							</label>
							<label class="radio">
								<input type="radio" name="contentAction" ng-model="data.contentAction" value="reject"/> {{ i18n('m.rbs.admin.workflow.rejected', ['ucf']) }}
							</label>
						</p>
					</div>
				</div>
			</div>

			<div ng-if="data.contentAction == 'reject'">
				<div class="control-group required">
					<label class="control-label" for="rejectContentField">{{ i18n('m.rbs.admin.workflow.reject-reason', ['ucf']) }}</label>
					<div class="controls">
						<input type="text" auto-focus="" placeholder="{{ i18nAttr('m.rbs.admin.workflow.why-do-you-reject-content', ['ucf']) }}" id="rejectContentField" required="required" class="input-block-level" ng-model="data.rejectReason"/>
					</div>
				</div>
				<div class="control-group">
					<div class="controls">
						<rbs-button-help-toggle class="pull-right" value="data.helpShown"></rbs-button-help-toggle>
						<button type="submit" ng-disabled="wfForm.$invalid" class="btn btn-danger">{{ i18n('m.rbs.admin.workflow.reject-content', ['ucf']) }}</button>
					</div>
				</div>
			</div>

			<div ng-if="data.contentAction == 'accept'">
				<div class="control-group">
					<div class="controls">
						<rbs-button-help-toggle class="pull-right" value="data.helpShown"></rbs-button-help-toggle>
						<button type="submit" class="btn btn-success">{{ i18n('m.rbs.admin.workflow.accept-content', ['ucf']) }}</button>
					</div>
				</div>
			</div>

		</div>

		<div class="control-group" ng-switch-when="publicationValidation">
			<div class="controls">
				<p>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.request-validation-done', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.content-validated', ['ucf']) }}</div>
				</p>
				<rbs-button-help-toggle class="pull-right" value="data.helpShown"></rbs-button-help-toggle>
				<button type="submit" class="btn btn-success">{{ i18n('m.rbs.admin.workflow.accept-publication', ['ucf']) }}</button>
			</div>
		</div>

		<div class="control-group" ng-switch-when="freeze">
			<div class="controls">
				<p>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.request-validation-done', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.content-validated', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.publication-validated', ['ucf']) }}</div>
				</p>
				<p>{{ i18n('m.rbs.admin.workflow.you-can-freeze-document') }}</p>
				<rbs-button-help-toggle class="pull-right" value="data.helpShown"></rbs-button-help-toggle>
				<button type="submit" class="btn btn-warning"><i class="icon-pause"></i> {{ i18n('m.rbs.admin.workflow.freeze-document', ['ucf']) }}</button>
			</div>
		</div>

		<div class="control-group" ng-switch-when="unfreeze">
			<div class="controls">
				<p>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.request-validation-done', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.content-validated', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.publication-validated', ['ucf']) }}</div>
					<div style="color: darkred"><i class="icon-pause"></i> {{ i18n('m.rbs.admin.workflow.frozen-document', ['ucf']) }}</div>
				</p>
				<p>{{ i18n('m.rbs.admin.workflow.this-document-is-frozen') }}</p>
				<rbs-button-help-toggle class="pull-right" value="data.helpShown"></rbs-button-help-toggle>
				<button type="submit" class="btn btn-success"><i class="icon-play"></i> {{ i18n('m.rbs.admin.workflow.unfreeze-document', ['ucf']) }}</button>
			</div>
		</div>

		<div class="control-group" ng-switch-when="correction">
			<div class="controls">
				<p>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.request-validation-done', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.content-validated', ['ucf']) }}</div>
					<div style="color: green"><i class="icon-ok"></i> {{ i18n('m.rbs.admin.workflow.publication-validated', ['ucf']) }}</div>
					<div style="color: darkred"><i class="icon-pencil"></i> {{ i18n('m.rbs.admin.workflow.modified-content-correction') }}</div>
				</p>

				<p>
					<span class="label label-important">{{ i18n('m.rbs.admin.workflow.caution', ['ucf']) }}</span>
					{{ i18n('m.rbs.admin.workflow.document-has-been-modified-since-its-publication') }}
				</p>
				<p>
					{{ i18n('m.rbs.admin.workflow.to-validate-correction-please-go-to', ['ucf']) }}
					<a href ng-href="(= document|rbsURL =)">{{ i18n('m.rbs.admin.workflow.document-editor') }}</a>
					{{ i18n('m.rbs.admin.workflow.to-check-modified-properties') }}.
				</p>
			</div>
		</div>


		<div class="progress" ng-if="hasProgressInfo()">
			<div class="bar" style="width: (= data.progress =)%;"></div>
		</div>

		<div class="alert alert-danger" ng-if="data.error">
			<rbs-button-close ng-click="data.error = null"></rbs-button-close>
			<h4>{{ i18n('m.rbs.admin.workflow.action-has-failed', ['ucf']) }}</h4>
			<p ng-bind-html="data.error"></p>
		</div>

	</form>


	<div ng-if="data.helpShown" class="workflow-help">
		<div class="step" ng-class="{'current': data.action=='requestValidation'}">
			<div class="block">
				<h5><div class="bullet-status DRAFT"></div>{{ i18n('m.rbs.admin.workflow.status-draft', ['ucf']) }}</h5>
				<div class="action"><i class="icon-angle-down"></i> {{ i18n('m.rbs.admin.workflow.request-validation', ['ucf']) }}</div>
				<div class="action"><i class="icon-double-angle-down"></i> {{ i18n('m.rbs.admin.workflow.run-all-steps-button', ['ucf']) }}</div>
			</div>
			<div class="explain">
				{{ i18n('m.rbs.admin.workflow.help-draft-explain') }}
			</div>
		</div>
		<div class="arrow">
			<i class="icon-arrow-down"></i>
		</div>
		<div class="step" ng-class="{'current': data.action=='contentValidation'}">
			<div class="block">
				<h5><div class="bullet-status VALIDATION"></div>{{ i18n('m.rbs.admin.workflow.status-validation', ['ucf']) }}</h5>
				<div class="action reject"><i class="icon-angle-up"></i> {{ i18n('m.rbs.admin.workflow.reject', ['ucf']) }}</div>
				<div class="action accept"><i class="icon-angle-down"></i> {{ i18n('m.rbs.admin.workflow.accept', ['ucf']) }}</div>
			</div>
			<div class="explain">
				{{ i18n('m.rbs.admin.workflow.help-validation-explain') }}
			</div>
		</div>
		<div class="arrow">
			<i class="icon-arrow-down"></i>
		</div>
		<div class="step" ng-class="{'current': data.action=='publicationValidation'}">
			<div class="block">
				<h5><div class="bullet-status VALIDCONTENT"></div> {{ i18n('m.rbs.admin.workflow.status-validcontent', ['ucf']) }}</h5>
				<div class="action"><i class="icon-angle-down"></i> {{ i18n('m.rbs.admin.workflow.accept-publication', ['ucf']) }}</div>
			</div>
			<div class="explain">
				{{ i18n('m.rbs.admin.workflow.help-validcontent-explain') }}
			</div>
		</div>
		<div class="arrow">
			<i class="icon-arrow-down"></i>
		</div>
		<div class="step" ng-class="{'current': data.action=='freeze'}">
			<div class="block">
				<h5><div class="bullet-status PUBLISHABLE"></div>{{ i18n('m.rbs.admin.workflow.status-publishable', ['ucf']) }}</h5>
				<div class="action reject"><i class="icon-angle-down"></i> {{ i18n('m.rbs.admin.workflow.freeze', ['ucf']) }}</div>
			</div>
			<div class="explain">
				{{ i18n('m.rbs.admin.workflow.help-publishable-explain') }}
			</div>
		</div>
		<div class="arrow">
			<i class="icon-arrow-down"></i>
		</div>
		<div class="step" ng-class="{'current': data.action=='unfreeze'}">
			<div class="block">
				<h5><div class="bullet-status FROZEN"></div>{{ i18n('m.rbs.admin.workflow.status-frozen', ['ucf']) }}</h5>
				<div class="action accept"><i class="icon-angle-up"></i> {{ i18n('m.rbs.admin.workflow.unfreeze', ['ucf']) }}</div>
			</div>
			<div class="explain">
				{{ i18n('m.rbs.admin.workflow.help-frozen-explain') }}
			</div>
		</div>
	</div>


</div>